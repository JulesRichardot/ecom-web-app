{% extends "base.html" %}

{% block title %}Mon Compte - Sneakly{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1><i class="fas fa-user"></i> Mon Compte</h1>
        <p>Bienvenue, {{ user.first_name }} {{ user.last_name }}</p>
    </div>
    
    <div class="dashboard-grid">
        <!-- Informations personnelles -->
        <div class="dashboard-card">
            <div class="card-header">
                <h2><i class="fas fa-user-circle"></i> Informations personnelles</h2>
                <button class="btn btn-secondary btn-sm" onclick="editProfile()">
                    <i class="fas fa-edit"></i> Modifier
                </button>
            </div>
            <div class="card-content">
                <div class="info-item">
                    <label>Nom complet</label>
                    <span>{{ user.first_name }} {{ user.last_name }}</span>
                </div>
                <div class="info-item">
                    <label>Email</label>
                    <span>{{ user.email }}</span>
                </div>
                <div class="info-item">
                    <label>Adresse</label>
                    <span>{{ user.address }}</span>
                </div>
            </div>
        </div>
        
        <!-- Statistiques -->
        <div class="dashboard-card">
            <div class="card-header">
                <h2><i class="fas fa-chart-bar"></i> Mes statistiques</h2>
            </div>
            <div class="card-content">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number">{{ orders|length }}</div>
                        <div class="stat-label">Commandes</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">
                            {{ "%.0f"|format(total_spent / 100) }}€
                        </div>
                        <div class="stat-label">Total dépensé</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Actions rapides -->
        <div class="dashboard-card">
            <div class="card-header">
                <h2><i class="fas fa-bolt"></i> Actions rapides</h2>
            </div>
            <div class="card-content">
                <div class="quick-actions">
                    <a href="{{ url_for('orders') }}" class="action-btn">
                        <i class="fas fa-box"></i>
                        <span>Mes commandes</span>
                    </a>
                    <a href="{{ url_for('cart') }}" class="action-btn">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Mon panier</span>
                    </a>
                    <a href="{{ url_for('support') }}" class="action-btn">
                        <i class="fas fa-headset"></i>
                        <span>Support</span>
                    </a>
                    <a href="{{ url_for('index') }}" class="action-btn">
                        <i class="fas fa-shopping-bag"></i>
                        <span>Continuer mes achats</span>
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Dernières commandes -->
        <div class="dashboard-card full-width">
            <div class="card-header">
                <h2><i class="fas fa-history"></i> Dernières commandes</h2>
                <a href="{{ url_for('orders') }}" class="btn btn-secondary btn-sm">
                    Voir toutes <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            <div class="card-content">
                {% if orders %}
                    <div class="orders-list">
                        {% for order in orders[:3] %}
                        <div class="order-item">
                            <div class="order-info">
                                <div class="order-id">Commande #{{ order.id[:8] }}</div>
                                <div class="order-date">{{ order.created_at|int|timestamp_to_date }}</div>
                            </div>
                            <div class="order-status">
                                <span class="status-badge status-{{ order.status.name.lower() }}">
                                    {{ order.status.name }}
                                </span>
                            </div>
                            <div class="order-total">
                                {{ "%.2f"|format(order.total_cents() / 100) }}€
                            </div>
                            <div class="order-actions">
                                <a href="{{ url_for('orders') }}#order-{{ order.id }}" class="btn btn-sm btn-outline">
                                    Voir détails
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-shopping-bag"></i>
                        <h3>Aucune commande</h3>
                        <p>Vous n'avez pas encore passé de commande</p>
                        <a href="{{ url_for('index') }}" class="btn btn-primary">
                            <i class="fas fa-shopping-bag"></i>
                            Commencer mes achats
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Modal de modification du profil -->
<div id="profile-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-edit"></i> Modifier mon profil</h2>
            <button class="modal-close" onclick="closeProfileModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="modal-body">
            <form id="profile-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-first-name">Prénom</label>
                        <input type="text" id="edit-first-name" value="{{ user.first_name }}" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-last-name">Nom</label>
                        <input type="text" id="edit-last-name" value="{{ user.last_name }}" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="edit-address">Adresse</label>
                    <textarea id="edit-address" rows="3" required>{{ user.address }}</textarea>
                </div>
                
                <div class="form-group">
                    <label for="current-password">Mot de passe actuel (pour confirmer)</label>
                    <input type="password" id="current-password" placeholder="Votre mot de passe actuel">
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeProfileModal()">
                        Annuler
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Sauvegarder
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function editProfile() {
    document.getElementById('profile-modal').style.display = 'flex';
}

function closeProfileModal() {
    document.getElementById('profile-modal').style.display = 'none';
}

document.getElementById('profile-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = {
        first_name: document.getElementById('edit-first-name').value,
        last_name: document.getElementById('edit-last-name').value,
        address: document.getElementById('edit-address').value,
        current_password: document.getElementById('current-password').value
    };
    
    // Ici vous pourriez ajouter une API pour mettre à jour le profil
    showNotification('Profil mis à jour avec succès !', 'success');
    closeProfileModal();
    setTimeout(() => location.reload(), 1000);
});

// Fermer le modal en cliquant à l'extérieur
document.getElementById('profile-modal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeProfileModal();
    }
});
</script>
{% endblock %}
